<!DOCTYPE html>
<html>
<head>
  <title>Dual-Mode Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
    button { padding: 10px 20px; margin: 5px; background: #333; color: #0f0; border: 1px solid #0f0; cursor: pointer; }
    button:hover { background: #0f0; color: #000; }
    .result { margin: 10px 0; padding: 10px; background: #222; border-left: 3px solid #0f0; }
    .error { border-left-color: #f00; color: #f00; }
    .success { border-left-color: #0f0; color: #0f0; }
  </style>
</head>
<body>
  <h1>üöÄ Dual-Mode Routing Test</h1>
  
  <div>
    <h2>Portal Actions (‚Üí Vercel)</h2>
    <button onclick="testPortalLogin()">Test portal_login</button>
    <button onclick="testPortalMe()">Test portal_me</button>
    <button onclick="testPortalJobs()">Test portal_jobs</button>
  </div>
  
  <div>
    <h2>Admin Actions (‚Üí Apps Script)</h2>
    <button onclick="testAdminLogin()">Test admin_login</button>
    <button onclick="testAdminJobs()">Test admin_jobs_list</button>
  </div>
  
  <div id="results"></div>

  <script>
    const VERCEL_API = "https://h2s-backend-ilji6wsr4-tabari-ropers-projects-6f2e090b.vercel.app/api";
    const APPS_SCRIPT_API = "https://script.google.com/macros/s/AKfycbxvkqZG4mCec7Pol-tlZy9o6aIfnnh7xuQWYpFayGTwPDKd2f1Px3Qj_a-D0zjM5bM_jw/exec";
    const USE_VERCEL_FOR_PORTAL = true;
    
    let sessionToken = null;
    
    function log(message, isError = false) {
      const div = document.createElement('div');
      div.className = 'result ' + (isError ? 'error' : 'success');
      div.textContent = message;
      document.getElementById('results').prepend(div);
    }
    
    async function testPortalLogin() {
      try {
        log('Testing portal_login ‚Üí Vercel...');
        const endpoint = `${VERCEL_API}/portal_login`;
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: 'tabariroper14@icloud.com', pin: '29649' })
        });
        const data = await res.json();
        if (data.ok) {
          sessionToken = data.token;
          log(`‚úÖ portal_login SUCCESS - Token: ${sessionToken.substring(0, 20)}...`);
        } else {
          log(`‚ùå portal_login FAILED: ${JSON.stringify(data)}`, true);
        }
      } catch (err) {
        log(`‚ùå portal_login ERROR: ${err.message}`, true);
      }
    }
    
    async function testPortalMe() {
      if (!sessionToken) {
        log('‚ùå No session token - run portal_login first', true);
        return;
      }
      try {
        log('Testing portal_me ‚Üí Vercel...');
        const endpoint = `${VERCEL_API}/portal_me`;
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token: sessionToken })
        });
        const data = await res.json();
        if (data.ok) {
          log(`‚úÖ portal_me SUCCESS - Pro: ${data.pro.name}`);
        } else {
          log(`‚ùå portal_me FAILED: ${JSON.stringify(data)}`, true);
        }
      } catch (err) {
        log(`‚ùå portal_me ERROR: ${err.message}`, true);
      }
    }
    
    async function testPortalJobs() {
      if (!sessionToken) {
        log('‚ùå No session token - run portal_login first', true);
        return;
      }
      try {
        log('Testing portal_jobs ‚Üí Vercel...');
        const endpoint = `${VERCEL_API}/portal_jobs`;
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token: sessionToken })
        });
        const data = await res.json();
        if (data.ok) {
          log(`‚úÖ portal_jobs SUCCESS - Offers: ${data.offers?.length || 0}, Upcoming: ${data.upcoming?.length || 0}, Completed: ${data.completed?.length || 0}`);
        } else {
          log(`‚ùå portal_jobs FAILED: ${JSON.stringify(data)}`, true);
        }
      } catch (err) {
        log(`‚ùå portal_jobs ERROR: ${err.message}`, true);
      }
    }
    
    async function testAdminLogin() {
      try {
        log('Testing admin_login ‚Üí Apps Script...');
        const url = `${APPS_SCRIPT_API}?action=admin_login&email=dispatch@h2s.com&pin=29649&t=${Date.now()}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.ok) {
          log(`‚úÖ admin_login SUCCESS - Role: ${data.role}`);
        } else {
          log(`‚ùå admin_login FAILED: ${JSON.stringify(data)}`, true);
        }
      } catch (err) {
        log(`‚ùå admin_login ERROR: ${err.message}`, true);
      }
    }
    
    async function testAdminJobs() {
      try {
        log('Testing admin_jobs_list ‚Üí Apps Script...');
        const url = `${APPS_SCRIPT_API}?action=admin_jobs_list&t=${Date.now()}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.ok) {
          log(`‚úÖ admin_jobs_list SUCCESS - Jobs: ${data.jobs?.length || 0}`);
        } else {
          log(`‚ùå admin_jobs_list FAILED: ${JSON.stringify(data)}`, true);
        }
      } catch (err) {
        log(`‚ùå admin_jobs_list ERROR: ${err.message}`, true);
      }
    }
  </script>
</body>
</html>
